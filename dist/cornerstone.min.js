/*! cornerstone - v0.6.1 - 2015-02-23 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
var cornerstone=function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,void 0===f.viewport&&(f.viewport=b.getDefaultViewport(f.canvas,d)),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}return void 0===b&&(b={}),b.displayImage=c,b}($,cornerstone),cornerstone=function(a,b){"use strict";function c(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={viewport:b.viewport,element:b.element,image:b.image,enabledElement:b,canvasContext:e,renderTimeInMs:g};a(b.element).trigger("CornerstoneImageRendered",h)}return void 0===b&&(b={}),b.drawImage=c,b}($,cornerstone),cornerstone=function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}return void 0===a&&(a={}),a.enable=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}return void 0===a&&(a={}),a.getElementData=b,a.removeElementData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){if(void 0===a)throw"disable: element element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element===a)return f[b].element.removeChild(f[b].canvas),void f.splice(b,1)}function e(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}void 0===a&&(a={});var f=[];return a.getEnabledElement=b,a.addEnabledElement=c,a.disable=d,a.getEnabledElementsByImageId=e,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.getDefaultViewport(c.canvas,c.image);c.viewport.scale=d.scale,c.viewport.translation.x=d.translation.x,c.viewport.translation.y=d.translation.y,c.viewport.rotation=d.rotation,c.viewport.hflip=d.hflip,c.viewport.vflip=d.vflip,a.updateImage(b)}return void 0===a&&(a={}),a.fitToWindow=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c,d){void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)));var e,f,g,h,i=a.lut,j=a.maxPixelValue,k=a.minPixelValue,l=a.slope,m=a.intercept,n=b,o=c;if(d===!0)for(h=a.minPixelValue;j>=h;h++)e=h*l+m,f=255*((e-o)/n+.5),g=Math.min(Math.max(f,0),255),i[h+-k]=Math.round(255-g);else for(h=a.minPixelValue;j>=h;h++)e=h*l+m,f=255*((e-o)/n+.5),g=Math.min(Math.max(f,0),255),i[h+-k]=Math.round(g)}return void 0===a&&(a={}),a.generateLut=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1},d=a.height/b.rows,e=a.width/b.columns;return c.scale=d>e?e:d,c}return void 0===a&&(a={}),a.getDefaultViewport=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}function c(c,d,e,f,g){var h=b(c,d,e,f,g),i=a.getEnabledElement(c),j=i.image.slope,k=i.image.intercept,l=h.map(function(a){return a*j+k});return l}return void 0===a&&(a={}),a.getStoredPixels=b,a.getPixels=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";k=a,c()}function c(){function a(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(k>=l))for(j.sort(a);l>k;){var b=j[j.length-1];l-=b.sizeInBytes,delete i[b.imageId],b.imagePromise.reject(),j.pop()}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(i.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,imagePromise:b,timeStamp:new Date,sizeInBytes:0};i[a]=d,j.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";d.sizeInBytes=a.sizeInBytes,l+=d.sizeInBytes,c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=i[a];return void 0===b?void 0:(b.timeStamp=new Date,b.imagePromise)}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=i[a];return void 0===b?!1:(j.splice(j.indexOf(b),1),l-=b.sizeInBytes,delete i[a],!0)}function g(){return{maximumSizeInBytes:k,cacheSizeInBytes:l,numberOfImagesCached:j.length}}function h(){for(;j.length>0;){var a=j.pop();delete i[a.imageId],a.imagePromise.reject()}l=0}void 0===a&&(a={});var i={},j=[],k=1073741824,l=0;return a.imageCache={putImagePromise:d,getImagePromise:e,removeImageId:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:h},a}(cornerstone),cornerstone=function(a,b){"use strict";function c(c){var d,e=c.indexOf(":"),f=c.substring(0,e),g=i[f];return void 0===g||null===g?void 0!==h?d=h(c):void 0:(d=g(c),d.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),d)}function d(a){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadImage: no image loader for imageId";return d}function e(a){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,d),d}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}void 0===b&&(b={});var h,i={};return b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g,b}($,cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}return void 0===a&&(a={}),a.invalidateImageId=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=b.getBoundingClientRect(),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i=g-f.width/2,j=h-f.height/2,k=e.viewport,l=e.viewport.scale,m=e.viewport.scale;e.image.rowPixelSpacing<e.image.columnPixelSpacing?l*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(m*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);var n=i/l,o=j/m,p=n-k.translation.x,q=o-k.translation.y;if(k.hflip&&(p*=-1),k.vflip&&(q*=-1),0!==k.rotation){var r=k.rotation*Math.PI/180,s=Math.cos(r),t=Math.sin(r),u=p*s-q*t,v=p*t+q*s;(90===k.rotation||270===k.rotation||-90===k.rotation||-270===k.rotation)&&(u*=-1,v*=-1),p=u,q=v}return p+=e.image.columns/2,q+=e.image.rows/2,{x:p,y:q}}return void 0===a&&(a={}),a.pageToPixel=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip?!0:!1}function e(e,f,i){if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&e.viewport.invert===!1)return f.getCanvas();if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport);return a.storedColorPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}void 0===a&&(a={});var g,h,i,j=document.createElement("canvas"),k={};return a.renderColorImage=f,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c,d){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert&&d!==!0?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip?!0:!1}function e(e,f,i){if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport,i);return a.storedPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}void 0===a&&(a={});var g,h,i,j=document.createElement("canvas"),k={};return a.renderGrayscaleImage=f,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}return void 0===a&&(a={}),a.renderWebImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&(d===!0?a.fitToWindow(c):a.updateImage(c))}return void 0===a&&(a={}),a.resize=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){if(void 0===a)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===b)throw"setToPixelCoordinateSystem: parameter context must not be undefined";b.setTransform(1,0,0,1,0,0),b.translate(a.canvas.width/2,a.canvas.height/2);var d=a.viewport.scale,e=a.viewport.scale;a.image.rowPixelSpacing<a.image.columnPixelSpacing?d*=a.image.columnPixelSpacing/a.image.rowPixelSpacing:a.image.columnPixelSpacing<a.image.rowPixelSpacing&&(e*=a.image.rowPixelSpacing/a.image.columnPixelSpacing),b.scale(d,e),b.translate(a.viewport.translation.x,a.viewport.translation.y),void 0===c?c=1:b.scale(c,c);var f=a.viewport.rotation;0!==f&&b.rotate(f*Math.PI/180),a.viewport.hflip&&(b.translate(a.offsetWidth,0),b.scale(-1,1)),a.viewport.vflip&&(b.translate(0,a.offsetHeight),b.scale(1,-1)),b.translate(-a.image.width/2/c,-a.image.height/2/c)}return void 0===a&&(a={}),a.setToPixelCoordinateSystem=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){var d=a.getPixelData(),e=a.minPixelValue,f=3,g=0,h=d.length,i=d,j=b,k=c;if(0>e)for(;h>g;)k[f]=j[i[g++]+-e],f+=4;else for(;h>g;)k[f]=j[i[g++]],f+=4}function c(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;if(0>d)for(;g>f;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;g>f;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}return void 0===a&&(a={}),a.storedPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}return void 0===a&&(a={}),a.updateImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.pixelReplication=c.pixelReplication,d.viewport.rotation=c.rotation,d.viewport.hflip=c.hflip,d.viewport.vflip=c.vflip,d.viewport.voi.windowWidth<1&&(d.viewport.voi.windowWidth=1),d.viewport.scale<1e-4&&(d.viewport.scale=.25),(360===d.viewport.rotation||-360===d.viewport.rotation)&&(d.viewport.rotation=0),a.updateImage(b)}function c(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0===d?void 0:{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip}}return void 0===a&&(a={}),a.getViewport=c,a.setViewport=b,a}(cornerstone);