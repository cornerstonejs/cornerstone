/*! cornerstone - v0.8.1 - 2015-08-06 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(a){"use strict";function b(b){if(void 0===b)throw"disable: element element must not be undefined";for(var c=a.getEnabledElements(),d=0;d<c.length;d++)if(c[d].element===b){var e={element:b};return $(b).trigger("CornerstoneElementDisabled",e),c[d].element.removeChild(c[d].canvas),void c.splice(d,1)}}a.disable=b}(cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,void 0===f.viewport&&(f.viewport=b.internal.getDefaultViewport(f.canvas,d)),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);if(void 0===c.image)throw"draw: image has not been loaded yet";b.drawImage(c)}b.draw=c}($,cornerstone),function(a,b){"use strict";function c(){for(var a=b.getEnabledElements(),c=0;c<a.length;c++){var d=a[c];d.invalid===!0&&b.drawImage(d)}}b.drawInvalidated=c}($,cornerstone),function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,invalid:!1,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}a.enable=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}a.getElementData=b,a.removeElementData=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}function e(){return f}var f=[];a.getEnabledElement=b,a.addEnabledElement=c,a.getEnabledElementsByImageId=d,a.getEnabledElements=e}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.internal.getDefaultViewport(c.canvas,c.image);c.viewport.scale=d.scale,c.viewport.translation.x=d.translation.x,c.viewport.translation.y=d.translation.y,c.viewport.rotation=d.rotation,c.viewport.hflip=d.hflip,c.viewport.vflip=d.vflip,a.updateImage(b)}a.fitToWindow=b}(cornerstone),function(a,b){"use strict";function c(a,c){var d=b.getEnabledElement(a),e=b.internal.getDefaultViewport(d.canvas,c);return e}b.getDefaultViewportForImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);return c.image}b.getImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f){var g=a.getStoredPixels(b,c,d,e,f),h=a.getEnabledElement(b),i=h.image.slope,j=h.image.intercept,k=g.map(function(a){return a*i+j});return k}a.getPixels=b}(cornerstone),function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}a.getStoredPixels=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0===d?void 0:{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip}}a.getViewport=b}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";k=a,c()}function c(){function a(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(k>=l))for(j.sort(a);l>k;){var b=j[j.length-1];l-=b.sizeInBytes,delete i[b.imageId],b.imagePromise.reject(),j.pop()}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(i.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,imagePromise:b,timeStamp:new Date,sizeInBytes:0};i[a]=d,j.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";d.sizeInBytes=a.sizeInBytes,l+=d.sizeInBytes,c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=i[a];return void 0===b?void 0:(b.timeStamp=new Date,b.imagePromise)}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=i[a];if(void 0===b)throw"removeImagePromise: imageId must not be undefined";return j.splice(j.indexOf(b),1),l-=b.sizeInBytes,delete i[a],b.imagePromise}function g(){return{maximumSizeInBytes:k,cacheSizeInBytes:l,numberOfImagesCached:j.length}}function h(){for(;j.length>0;){var a=j.pop();delete i[a.imageId],a.imagePromise.reject()}l=0}var i={},j=[],k=1073741824,l=0;a.imageCache={putImagePromise:d,getImagePromise:e,removeImagePromise:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:h}}(cornerstone),function(a,b){"use strict";function c(c){var d,e=c.indexOf(":"),f=c.substring(0,e),g=i[f];return void 0===g||null===g?void 0!==h?d=h(c):void 0:(d=g(c),d.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),d)}function d(a){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadImage: no image loader for imageId";return d}function e(a){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,d),d}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}var h,i={};b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g}($,cornerstone),function(a){"use strict";function b(b,c){var d=new a.internal.Transform;d.translate(b.canvas.width/2,b.canvas.height/2);var e=b.viewport.rotation;0!==e&&d.rotate(e*Math.PI/180);var f=b.viewport.scale,g=b.viewport.scale;return b.image.rowPixelSpacing<b.image.columnPixelSpacing?f*=b.image.columnPixelSpacing/b.image.rowPixelSpacing:b.image.columnPixelSpacing<b.image.rowPixelSpacing&&(g*=b.image.rowPixelSpacing/b.image.columnPixelSpacing),d.scale(f,g),0!==e&&d.rotate(-e*Math.PI/180),d.translate(b.viewport.translation.x,b.viewport.translation.y),0!==e&&d.rotate(e*Math.PI/180),void 0!==c&&d.scale(c,c),b.viewport.hflip&&d.scale(-1,1),b.viewport.vflip&&d.scale(1,-1),d.translate(-b.image.width/2,-b.image.height/2),d}a.internal.calculateTransform=b}(cornerstone),function(a,b){"use strict";function c(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={viewport:b.viewport,element:b.element,image:b.image,enabledElement:b,canvasContext:e,renderTimeInMs:g};a(b.element).trigger("CornerstoneImageRendered",h),b.invalid=!1}b.internal.drawImage=c,b.drawImage=c}($,cornerstone),function(a){"use strict";function b(a,b,c,d){void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)+1));var e,f,g,h,i=a.lut,j=a.maxPixelValue,k=a.minPixelValue,l=a.slope,m=a.intercept,n=b,o=c,p=0;if(0>k&&(p=k),d===!0)for(h=a.minPixelValue;j>=h;h++)e=h*l+m,f=255*((e-o)/n+.5),g=Math.min(Math.max(f,0),255),i[h+-p]=Math.round(255-g);else for(h=a.minPixelValue;j>=h;h++)e=h*l+m,f=255*((e-o)/n+.5),g=Math.min(Math.max(f,0),255),i[h+-p]=Math.round(g)}a.internal.generateLut=b,a.generateLut=b}(cornerstone),function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1},d=a.height/b.rows,e=a.width/b.columns;return d>e?c.scale=e:c.scale=d,c}a.internal.getDefaultViewport=b,a.getDefaultViewport=b}(cornerstone),function(a){"use strict";function b(b){var c=a.internal.calculateTransform(b);return c}a.internal.getTransform=b}(cornerstone),function(a,b){"use strict";b.drawImage=b.internal.drawImage,b.generateLut=b.internal.generateLut,b.storedPixelDataToCanvasImageData=b.internal.storedPixelDataToCanvasImageData,b.storedColorPixelDataToCanvasImageData=b.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(a){"use strict";function b(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;if(0>d)for(;g>f;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;g>f;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}a.internal.storedColorPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.getPixelData(),e=a.minPixelValue,f=3,g=0,h=d.length,i=d,j=b,k=c;if(0>e)for(;h>g;)k[f]=j[i[g++]+-e],f+=4;else for(;h>g;)k[f]=j[i[g++]],f+=4}a.internal.storedPixelDataToCanvasImageData=b,a.storedPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(){this.reset()}b.prototype.reset=function(){this.m=[1,0,0,1,0,0]},b.prototype.clone=function(){var a=new b;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a},b.prototype.multiply=function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},b.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},b.prototype.scale=function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},b.prototype.transformPoint=function(a,b){var c=a,d=b;return a=c*this.m[0]+d*this.m[2]+this.m[4],b=c*this.m[1]+d*this.m[3]+this.m[5],{x:a,y:b}},a.internal.Transform=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b);c.invalid=!0;var d={element:b};$(c.element).trigger("CornerstoneInvalidated",d)}a.invalidate=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}a.invalidateImageId=b}(cornerstone),function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=(e.image,b.getBoundingClientRect()),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i={x:g,y:h},j=a.internal.getTransform(e);return j.invert(),j.transformPoint(i.x,i.y)}a.pageToPixel=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.transformPoint(c.x,c.y)}a.pixelToCanvas=b}(cornerstone),function(a){"use strict";function b(b){var c=b.datatype;if(c=c||"int16",console.log("Datatype: "+b.datatype),a.shaders.hasOwnProperty(c))return a.shaders[c];var d=a.shaders.rgb;return d}a.rendering.getShader=b}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.createProgram(),e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,b),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw"An error occurred compiling the fragment shader "+a.getShaderInfoLog(e);a.attachShader(d,e);var f=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(f,c),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))throw"An error occurred compiling the vertex shader"+a.getShaderInfoLog(f);if(a.attachShader(d,f),a.linkProgram(d),!a.getProgramParameter(d,a.LINK_STATUS))throw"Unable to initialize the shader program."+a.getShaderInfoLog(d);return a.useProgram(d),d}a.rendering.initShaders=b}(cornerstone),function(a){"use strict";function b(a){var b=null;try{var c={preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0};b=a.getContext("webgl",c)||a.getContext("experimental-webgl",c)}catch(d){throw"Error creating WebGL context"}return b||(alert("Unable to initialize WebGL. Your browser may not support it."),b=null),b}a.rendering.initWebGL=b}(cornerstone),function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip?!0:!1}function e(e,f,i){if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&e.viewport.invert===!1)return f.getCanvas();if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport);return a.storedColorPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}var g,h,i,j=document.createElement("canvas"),k={};a.rendering.colorImage=f,a.renderColorImage=f}(cornerstone),function(a){"use strict";function b(b,c){return i||(i=a.rendering.initShaders(b,c.frag,c.vert)),i}function c(b){return j||(j=j=a.shaders.rgb),j}function d(d){var e=d.image;l.width=e.width,l.height=e.height;e.getPixelData();if(h=a.rendering.initWebGL(l)){j=c(e),i=b(h,j),h.clearColor(.5,0,0,1);var f=e.width,g=e.height,k=h[j.format],m=h.createTexture();h.bindTexture(h.TEXTURE_2D,m),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);var n=(d.viewport,j.storedColorPixelDataToCanvasImageData(e));h.texImage2D(h.TEXTURE_2D,0,k,f,g,0,k,h.UNSIGNED_BYTE,n);var o=h.getAttribLocation(i,"a_position"),p=h.getAttribLocation(i,"a_texCoord"),q=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,q),h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),h.STATIC_DRAW),h.enableVertexAttribArray(p),h.vertexAttribPointer(p,2,h.FLOAT,!1,0,0);var r=h.createBuffer();return h.bindBuffer(h.ARRAY_BUFFER,r),h.enableVertexAttribArray(o),h.vertexAttribPointer(o,2,h.FLOAT,!1,0,0),a.rendering.setRectangle(h,0,0,f,g),h}}function e(a,b){return b.imageId!==k||m.windowCenter!==a.viewport.voi.windowCenter||m.windowWidth!==a.viewport.voi.windowWidth||m.invert!==a.viewport.invert||m.rotation!==a.viewport.rotation||m.hflip!==a.viewport.hflip||m.vflip!==a.viewport.vflip?!0:!1}function f(a,b,c){return(e(a,b)||c)&&d(a),h}function g(d,e){if(!d)throw"drawImage: enabledElement parameter must not be undefined";var g=d.image;if(!g)throw"drawImage: image must be loaded before it can be drawn";var n=d.canvas.getContext("2d");if(n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,d.canvas.width,d.canvas.height),d.viewport.pixelReplication===!0?(n.imageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1):(n.imageSmoothingEnabled=!0,n.mozImageSmoothingEnabled=!0),h=f(d,g,e)){j=c(g),i=b(h,j);var o=g.width,p=g.height,q=h.getUniformLocation(i,"u_resolution");h.uniform2f(q,o,p);var r=h.getUniformLocation(i,"wc");h.uniform1f(r,d.viewport.voi.windowCenter);var s=h.getUniformLocation(i,"ww");h.uniform1f(s,d.viewport.voi.windowWidth);var t=h.getUniformLocation(i,"slope");h.uniform1f(t,g.slope);var u=h.getUniformLocation(i,"intercept");h.uniform1f(u,g.intercept);var v=h.getUniformLocation(i,"minPixelValue");h.uniform1f(v,g.minPixelValue);var w=h.getUniformLocation(i,"invert"),x=d.viewport.invert?1:0;h.uniform1i(w,x),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),h.drawArrays(h.TRIANGLES,0,6),a.setToPixelCoordinateSystem(d,n),n.drawImage(l,0,0,g.width,g.height,0,0,g.width,g.height),k=g.imageId,m.windowCenter=d.viewport.voi.windowCenter,m.windowWidth=d.viewport.voi.windowWidth,m.invert=d.viewport.invert,m.rotation=d.viewport.rotation,m.hflip=d.viewport.hflip,m.vflip=d.viewport.vflip}}var h,i,j,k,l=document.createElement("canvas"),m={};a.rendering.grayscaleImageWebGL=g,a.renderColorImageWebGL=g}(cornerstone),function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c,d){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert&&d!==!0?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip?!0:!1}function e(e,f,i){if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport,i);return a.storedPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}var g,h,i,j=document.createElement("canvas"),k={};a.rendering.grayscaleImage=f,a.renderGrayscaleImage=f}(cornerstone),function(a){"use strict";function b(b,c){return i||(i=a.rendering.initShaders(b,c.frag,c.vert)),i}function c(b){return j||(j=a.rendering.getShader(b)),j}function d(d){var e=d.image;l.width=e.width,l.height=e.height;var f=e.getPixelData();if(h=a.rendering.initWebGL(l)){j=c(e),i=b(h,j),h.clearColor(.5,0,0,1);var g=e.width,k=e.height,m=h[j.format],n=h.createTexture();h.bindTexture(h.TEXTURE_2D,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);var o=j.storedPixelDataToImageData(f,g,k);h.texImage2D(h.TEXTURE_2D,0,m,g,k,0,m,h.UNSIGNED_BYTE,o);var p=h.getAttribLocation(i,"a_position"),q=h.getAttribLocation(i,"a_texCoord"),r=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,r),h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),h.STATIC_DRAW),h.enableVertexAttribArray(q),h.vertexAttribPointer(q,2,h.FLOAT,!1,0,0);var s=h.createBuffer();return h.bindBuffer(h.ARRAY_BUFFER,s),h.enableVertexAttribArray(p),h.vertexAttribPointer(p,2,h.FLOAT,!1,0,0),a.rendering.setRectangle(h,0,0,g,k),h}}function e(a,b){return b.imageId!==k||m.windowCenter!==a.viewport.voi.windowCenter||m.windowWidth!==a.viewport.voi.windowWidth||m.invert!==a.viewport.invert||m.rotation!==a.viewport.rotation||m.hflip!==a.viewport.hflip||m.vflip!==a.viewport.vflip?!0:!1}function f(a,b,c){return(e(a,b)||c)&&d(a),h}function g(c,d){if(!c)throw"drawImage: enabledElement parameter must not be undefined";var e=c.image;if(!e)throw"drawImage: image must be loaded before it can be drawn";var g=c.canvas.getContext("2d");if(g.setTransform(1,0,0,1,0,0),g.fillStyle="black",g.fillRect(0,0,c.canvas.width,c.canvas.height),c.viewport.pixelReplication===!0?(g.imageSmoothingEnabled=!1,g.mozImageSmoothingEnabled=!1):(g.imageSmoothingEnabled=!0,g.mozImageSmoothingEnabled=!0),j=a.rendering.getShader(e),h=f(c,e,d)){i=b(h,j);var n=e.width,o=e.height,p=h.getUniformLocation(i,"u_resolution");h.uniform2f(p,n,o);var q=h.getUniformLocation(i,"wc");h.uniform1f(q,c.viewport.voi.windowCenter);var r=h.getUniformLocation(i,"ww");h.uniform1f(r,c.viewport.voi.windowWidth);var s=h.getUniformLocation(i,"slope");h.uniform1f(s,e.slope);var t=h.getUniformLocation(i,"intercept");h.uniform1f(t,e.intercept);var u=h.getUniformLocation(i,"minPixelValue");h.uniform1f(u,e.minPixelValue);var v=h.getUniformLocation(i,"invert"),w=c.viewport.invert?1:0;h.uniform1i(v,w),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),h.drawArrays(h.TRIANGLES,0,6),a.setToPixelCoordinateSystem(c,g),g.drawImage(l,0,0,e.width,e.height,0,0,e.width,e.height),k=e.imageId,m.windowCenter=c.viewport.voi.windowCenter,m.windowWidth=c.viewport.voi.windowWidth,m.invert=c.viewport.invert,m.rotation=c.viewport.rotation,m.hflip=c.viewport.hflip,m.vflip=c.viewport.vflip}}var h,i,j,k,l=document.createElement("canvas"),m={};a.rendering.grayscaleImageWebGL=g,a.renderGrayscaleImageWebGL=g}(cornerstone),function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}a.rendering.webImage=b,a.renderWebImage=b}(cornerstone),function(a){"use strict";function b(a,b,c,d,e){var f=b,g=b+d,h=c,i=c+e;a.bufferData(a.ARRAY_BUFFER,new Float32Array([f,h,g,h,f,i,f,i,g,h,g,i]),a.STATIC_DRAW)}a.rendering.setRectangle=b}(cornerstone),function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&(d===!0?a.fitToWindow(c):a.updateImage(c))}a.resize=c}(cornerstone),function(a){"use strict";function b(b,c,d){if(void 0===b)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===c)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var e=a.internal.calculateTransform(b,d);c.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5],e.m[6])}a.setToPixelCoordinateSystem=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.pixelReplication=c.pixelReplication,d.viewport.rotation=c.rotation,d.viewport.hflip=c.hflip,d.viewport.vflip=c.vflip,d.viewport.voi.windowWidth<1&&(d.viewport.voi.windowWidth=1),d.viewport.scale<1e-4&&(d.viewport.scale=.25),(360===d.viewport.rotation||-360===d.viewport.rotation)&&(d.viewport.rotation=0),a.updateImage(b)}a.setViewport=b}(cornerstone),function(a){"use strict";function b(a,b,c){for(var d=2,e=new Uint8Array(b*c*d),f=0,g=0;g<a.length;g++){var h=a[g];e[f++]=parseInt(255&h,10),e[f++]=parseInt(h>>8,10)}return e}a.shaders||(a.shaders={});var c={format:"LUMINANCE_ALPHA"};c.storedPixelDataToImageData=b,c.vert="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = ww - 1.0;intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.shaders.int16=c,a.shaders.uint16=c}(cornerstone),function(a){"use strict";function b(a){var b=a.minPixelValue,c=0,d=0,e=a.width*a.height*3,f=a.getPixelData(),g=new Uint8Array(e);if(0>b)for(;e>d;)g[c++]=f[d++]+-b,g[c++]=f[d++]+-b,g[c]=f[d]+-b,d+=2,c+=1;else for(;e>d;)g[c++]=f[d++],g[c++]=f[d++],g[c]=f[d],d+=2,c+=1;return g}a.shaders||(a.shaders={});var c={format:"RGB"};c.storedColorPixelDataToCanvasImageData=b,c.vert="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = ww - 1.0;color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",a.shaders.rgb=c}(cornerstone),function(a){"use strict";function b(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=parseInt(a[c],10);return b}a.shaders||(a.shaders={});var c={format:"ALPHA"};c.storedPixelDataToImageData=b,c.vert="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.a * 256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = ww - 1.0;intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.shaders.uint8=c}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}a.updateImage=b}(cornerstone);