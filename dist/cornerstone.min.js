/*! cornerstone - v0.9.0 - 2016-02-10 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(a){"use strict";function b(b){if(void 0===b)throw"disable: element element must not be undefined";for(var c=a.getEnabledElements(),d=0;d<c.length;d++)if(c[d].element===b){var e={element:b};return $(b).trigger("CornerstoneElementDisabled",e),c[d].element.removeChild(c[d].canvas),void c.splice(d,1)}}a.disable=b}(cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c),g=!1;if(void 0===f.image&&(f.canvas.style.backgroundColor="#fff"),f.image=d,void 0===f.viewport&&(f.viewport=b.internal.getDefaultViewport(f,d)),e)for(var h in e)null!==e[h]&&(f.viewport[h]=e[h]);f.canvas.width!=d.width&&(f.canvas.width=d.width,g=!0),f.canvas.height!=d.height&&(f.canvas.height=d.height,g=!0);var i,j=new Date;if(void 0!==f.lastImageTimeStamp){var k=j.getTime()-f.lastImageTimeStamp;i=(1e3/k).toFixed()}f.lastImageTimeStamp=j.getTime();var l={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:i};a(f.element).trigger("CornerstoneNewImage",l),(e||g)&&b.updateTransform(c),b.updateImage(c)}b.displayImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);if(void 0===c.image)throw"draw: image has not been loaded yet";b.drawImage(c)}b.draw=c}($,cornerstone),function(a){"use strict";function b(b,d,e){var f=a.getEnabledElement(b),g=f.canvasAnnot;if(!g)throw"you must enableAnnotation() before drawing them";f.shapes=d,f.texts=e,c(f)}function c(a){var b=a.canvasAnnot,c=b.getContext("2d"),d=a.viewport.rotation*Math.PI/180,e=(a.viewport.hflip?-1:1)*a.viewport.scale,f=(a.viewport.vflip?-1:1)*a.viewport.scale;c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,b.width,b.height),c.strokeStyle="white",c.fillStyle="white",c.font="12pt Arial",c.translate(a.viewport.translation.x+b.width/2,a.viewport.translation.y+b.height/2),c.scale(e,f),c.rotate(d),c.translate(-a.image.width/2,-a.image.height/2);var g,h,i=.5/a.viewport.scale;if(a.shapes)for(g=0,h=a.shapes.length;h>g;g++)c.save(),a.shapes[g](c,i)&&(c.setTransform(1,0,0,1,0,0),c.stroke(),c.restore());if(a.texts)for(c.textBaseline="bottom",c.textAlign="left",g=0,h=a.texts.length;h>g;g++){var j=a.texts[g],k=j.left+i,l=j.bottom+i,m=j.width/2,n=j.height/2,o=Math.abs(Math.cos(d)),p=Math.abs(Math.sin(d)),q={x:o*m+p*n,y:p*m+o*n},r=-q.x,s=-q.y;c.translate(k+m,l+n),c.rotate(-d),c.scale(a.viewport.hflip?-1:1,a.viewport.vflip?-1:1),c.translate(r,s),c.scale(1/a.viewport.scale,1/a.viewport.scale),c.fillText(j.text,0,0)}}a.drawAnnotation=b,a.internal.updateAnnotation=c,a.updateAnnotation=function(b){var d=a.getEnabledElement(b);if(!d)throw"element must be enabled";c(d)}}(cornerstone),function(a,b){"use strict";function c(){for(var a=b.getEnabledElements(),c=0;c<a.length;c++){var d=a[c];d.invalid===!0&&b.drawImage(d)}}b.drawInvalidated=c}($,cornerstone),function(a){"use strict";function b(b,d){if(void 0===b)throw"enable: parameter element cannot be undefined";var e=document.createElement("div");e.className="cornerstone-renderer";var f=document.createElement("canvas");e.appendChild(f),b.appendChild(e);var g={element:b,renderer:e,canvas:f,image:void 0,invalid:!1,data:{}};return a.addEnabledElement(g),d&&c(g),b}function c(a){var b=document.createElement("canvas");b.width=a.element.offsetWidth,b.height=a.element.offsetHeight,b.style.position="absolute",b.style.top=b.style.left=b.style.bottom=b.style.right=0,a.element.appendChild(b),a.canvasAnnot=b}a.enable=b,a.enableAnnotation=function(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var d=a.getEnabledElement(b);if(void 0===d)throw"enableAnnotation: element must be enabled first";c(d)}}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}a.getElementData=b,a.removeElementData=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}function e(){return f}var f=[];a.getEnabledElement=b,a.addEnabledElement=c,a.getEnabledElementsByImageId=d,a.getEnabledElements=e}(cornerstone),function(a){"use strict";function b(a){return 0===a.viewport.rotation||180===a.viewport.rotation?{width:a.image.width,height:a.image.height}:{width:a.image.height,height:a.image.width}}function c(c){var d=a.getEnabledElement(c),e=b(d),f=window.getComputedStyle(c);d.viewport.scale=a.internal.scaleToFit(parseInt(f.width),parseInt(f.height),e.width,e.height),d.viewport.translation.x=0,d.viewport.translation.y=0,a.internal.applyTransform(d)}a.fitToWindow=c}(cornerstone),function(a,b){"use strict";function c(a,c){var d=b.getEnabledElement(a),e=b.internal.getDefaultViewport(d,c);return e}b.getDefaultViewportForImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);return c.image}b.getImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f){var g=a.getStoredPixels(b,c,d,e,f),h=a.getEnabledElement(b),i=a.internal.getModalityLUT(h.image.slope,h.image.intercept,h.viewport.modalityLUT),j=g.map(i);return j}a.getPixels=b}(cornerstone),function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}a.getStoredPixels=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0!==d?{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip,modalityLUT:d.modalityLUT,voiLUT:d.voiLUT}:void 0}a.getViewport=b}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";n=a,c()}function c(){function b(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(n>=o)){for(m.sort(b);o>n;){var c=m[m.length-1];o-=c.sizeInBytes,delete k[c.imageId],c.imagePromise.reject(),m.pop(),$(a).trigger("CornerstoneImageCachePromiseRemoved",{imageId:c.imageId})}var d=a.imageCache.getCacheInfo();$(a).trigger("CornerstoneImageCacheFull",d)}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(k.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,sharedCacheKey:void 0,imagePromise:b,timeStamp:new Date,sizeInBytes:0};k[a]=d,m.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";a.sharedCacheKey?(d.sizeInBytes=a.sizeInBytes,d.sharedCacheKey=a.sharedCacheKey,l[a.sharedCacheKey]?l[a.sharedCacheKey]++:(l[a.sharedCacheKey]=1,o+=d.sizeInBytes)):(d.sizeInBytes=a.sizeInBytes,o+=d.sizeInBytes),c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=k[a];if(void 0!==b)return b.timeStamp=new Date,b.imagePromise}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=k[a];if(void 0===b)throw"removeImagePromise: imageId must not be undefined";return m.splice(m.indexOf(b),1),m.sharedCacheKey?1===l[m.sharedCacheKey]?(o-=b.sizeInBytes,delete l[m.sharedCacheKey]):l[m.sharedCacheKey]--:o-=b.sizeInBytes,delete k[a],h(b.imagePromise,b.imageId),b.imagePromise}function g(){return{maximumSizeInBytes:n,cacheSizeInBytes:o,numberOfImagesCached:m.length}}function h(a,b){a.then(function(c){c.decache&&c.decache(),a.reject(),delete k[b]}).always(function(){delete k[b]})}function i(){for(;m.length>0;){var a=m.pop();h(a.imagePromise,a.imageId)}o=0}function j(a,b){var c=k[a];c&&c.imagePromise.then(function(a){var c=b-a.sizeInBytes;a.sizeInBytes=b,o+=c})}var k={},l={},m=[],n=1073741824,o=0;a.imageCache={putImagePromise:d,getImagePromise:e,removeImagePromise:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:i,cachedImages:m,changeImageIdCacheSize:j}}(cornerstone),function(a,b){"use strict";function c(c){var d,e=c.indexOf(":"),f=c.substring(0,e),g=i[f];return void 0===g||null===g?void 0!==h?d=h(c):void 0:(d=g(c),d.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),d)}function d(a){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadImage: no image loader for imageId";return d}function e(a){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,d),d}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}var h,i={};b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g}($,cornerstone),function(a){"use strict";function b(b,c){var d=new a.internal.Transform;d.translate(b.canvas.width/2,b.canvas.height/2);var e=b.viewport.rotation;0!==e&&d.rotate(e*Math.PI/180);var f=b.viewport.scale,g=b.viewport.scale;return b.image.rowPixelSpacing<b.image.columnPixelSpacing?f*=b.image.columnPixelSpacing/b.image.rowPixelSpacing:b.image.columnPixelSpacing<b.image.rowPixelSpacing&&(g*=b.image.rowPixelSpacing/b.image.columnPixelSpacing),d.scale(f,g),0!==e&&d.rotate(-e*Math.PI/180),d.translate(b.viewport.translation.x,b.viewport.translation.y),0!==e&&d.rotate(e*Math.PI/180),void 0!==c&&d.scale(c,c),b.viewport.hflip&&d.scale(-1,1),b.viewport.vflip&&d.scale(1,-1),d.translate(-b.image.width/2,-b.image.height/2),d}a.internal.calculateTransform=b}(cornerstone),function(a,b){"use strict";function c(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={viewport:b.viewport,element:b.element,image:b.image,enabledElement:b,canvasContext:e,renderTimeInMs:g};a(b.element).trigger("CornerstoneImageRendered",h),b.invalid=!1}b.internal.drawImage=c,b.drawImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f,g){void 0===b.lut&&(b.lut=new Int16Array(b.maxPixelValue-Math.min(b.minPixelValue,0)+1));var h=b.lut,i=b.maxPixelValue,j=b.minPixelValue,k=a.internal.getModalityLUT(b.slope,b.intercept,f),l=a.internal.getVOILUT(c,d,g),m=0;0>j&&(m=j);var n,o,p,q;for(n=b.minPixelValue;i>=n;n++)o=k(n),p=l(o),q=Math.min(Math.max(p,0),255),e?h[n+-m]=Math.round(255-q):h[n+-m]=Math.round(q);return h}function c(a,c,d,e,f,g){if(f||g)return b(a,c,d,e,f,g);void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)+1));var h,i,j,k,l=a.lut,m=a.maxPixelValue,n=a.minPixelValue,o=a.slope,p=a.intercept,q=c,r=d,s=0;if(0>n&&(s=n),e===!0)for(k=a.minPixelValue;m>=k;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(255-j);else for(k=a.minPixelValue;m>=k;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(j)}a.internal.generateLutNew=b,a.internal.generateLut=c,a.generateLutNew=b,a.generateLut=c}(cornerstone),function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter enabledElement must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var d;if(a){var e=window.getComputedStyle(a.element),f=parseInt(e.width),g=parseInt(e.height);d=c(f,g,b.width,b.height)}else d=1;var h={scale:d,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:b.modalityLUT,voiLUT:b.voiLUT};return h}function c(a,b,c,d){return Math.min(a/c,b/d)}a.internal.getDefaultViewport=b,a.getDefaultViewport=b,a.internal.scaleToFit=c}(cornerstone),function(a){"use strict";function b(b){var c=a.internal.calculateTransform(b);return c}a.internal.getTransform=b}(cornerstone),function(a,b){"use strict";b.drawImage=b.internal.drawImage,b.generateLut=b.internal.generateLut,b.storedPixelDataToCanvasImageData=b.internal.storedPixelDataToCanvasImageData,b.storedColorPixelDataToCanvasImageData=b.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(a){"use strict";function b(a,b){var c=a,d=b;return function(a){return a*c+d}}function c(a){var b=a.lut[0],c=a.lut[a.lut.length-1],d=a.firstValueMapped+a.lut.length;return function(e){return e<a.firstValueMapped?b:e>=d?c:a.lut[e]}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getModalityLUT=d}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;if(0>d)for(;g>f;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;g>f;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}a.internal.storedColorPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.getPixelData(),e=a.minPixelValue,f=3,g=0,h=d.length,i=d,j=b,k=c;if(0>e)for(;h>g;)k[f]=j[i[g++]+-e],f+=4;else for(;h>g;)k[f]=j[i[g++]],f+=4}a.internal.storedPixelDataToCanvasImageData=b,a.storedPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(){this.reset()}b.prototype.reset=function(){this.m=[1,0,0,1,0,0]},b.prototype.clone=function(){var a=new b;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a},b.prototype.multiply=function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},b.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},b.prototype.scale=function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},b.prototype.transformPoint=function(a,b){var c=a,d=b;return a=c*this.m[0]+d*this.m[2]+this.m[4],b=c*this.m[1]+d*this.m[3]+this.m[5],{x:a,y:b}},a.internal.Transform=b}(cornerstone),function(a){"use strict";function b(a,b){return function(c){return 255*((c-b)/a+.5)}}function c(a){var b=a.numBitsPerEntry-8,c=a.lut[0]>>b,d=a.lut[a.lut.length-1]>>b,e=a.firstValueMapped+a.lut.length-1;return function(f){return f<a.firstValueMapped?c:f>=e?d:a.lut[f-a.firstValueMapped]>>b}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getVOILUT=d}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b);c.invalid=!0;var d={element:b};$(c.element).trigger("CornerstoneInvalidated",d)}a.invalidate=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}a.invalidateImageId=b}(cornerstone),function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=(e.image,b.getBoundingClientRect()),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i={x:g,y:h},j=a.internal.getTransform(e);return j.invert(),j.transformPoint(i.x,i.y)}a.pageToPixel=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.transformPoint(c.x,c.y)}a.pixelToCanvas=b}(cornerstone),function(a){"use strict";function b(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function c(c,d){if(void 0===c)throw"drawImage: enabledElement parameter must not be undefined";var e=c.image;if(void 0===e)throw"drawImage: image must be loaded before it can be drawn";var f=c.canvas,g=f.getContext("2d");if(c.viewport.voi.windowWidth===e.windowWidth&&c.viewport.voi.windowCenter===e.windowCenter&&c.viewport.invert===!1)g.drawImage(e.getCanvas(),0,0);else{g.fillStyle="#000",g.fillRect(0,0,f.width,f.height);var h=g.getImageData(0,0,f.width,f.height);a.storedColorPixelDataToCanvasImageData(e,b(e,c.viewport,d),h.data),g.putImageData(h,0,0)}}a.rendering.colorImage=c,a.renderColorImage=c}(cornerstone),function(a){"use strict";function b(a,b){return a||b?a&&b?a.id!==b.id:!1:!0}function c(c,d,e){return void 0!==c.lut&&c.lut.windowCenter===d.voi.windowCenter&&c.lut.windowWidth===d.voi.windowWidth&&b(c.lut.modalityLUT,d.modalityLUT)&&b(c.lut.voiLUT,d.voiLUT)&&c.lut.invert===d.invert&&e!==!0?c.lut:(a.generateLut(c,d.voi.windowWidth,d.voi.windowCenter,!d.invert,d.modalityLUT,d.voiLUT),c.lut.windowWidth=d.voi.windowWidth,c.lut.windowCenter=d.voi.windowCenter,c.lut.invert=d.invert,c.lut.voiLUT=d.voiLUT,c.lut.modalityLUT=d.modalityLUT,c.lut)}function d(b,d){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var e=b.image;if(void 0===e)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas,g=f.getContext("2d"),h=g.createImageData(f.width,f.height);a.storedPixelDataToCanvasImageData(e,c(e,b.viewport,d),h.data),g.putImageData(h,0,0)}a.rendering.grayscaleImage=d,a.renderGrayscaleImage=d}(cornerstone),function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}a.rendering.webImage=b,a.renderWebImage=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.internal.getDefaultViewport(c,c.image);c.viewport=d,a.updateImage(b)}a.reset=b}(cornerstone),function(a){"use strict"}(cornerstone),function(a){"use strict";function b(b,c,d){if(void 0===b)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===c)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var e=a.internal.calculateTransform(b,d);c.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5],e.m[6])}a.setToPixelCoordinateSystem=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=d.viewport,f=e.scale!=c.scale||e.translation.x!=c.translation.x||e.translation.y!=c.translation.y||e.rotation!=c.rotation||e.hflip!=c.hflip||e.vflip!=c.vflip,g=e.voi.windowWidth!=c.voi.windowWidth||e.voi.windowCenter!=c.voi.windowCenter||e.invert!=c.invert||e.modalityLUT!=c.modalityLUT||e.voiLUT!=c.voiLUT;e.scale=c.scale,e.translation.x=c.translation.x,e.translation.y=c.translation.y,e.voi.windowWidth=c.voi.windowWidth,e.voi.windowCenter=c.voi.windowCenter,e.invert=c.invert,e.pixelReplication=c.pixelReplication,e.rotation=c.rotation%360,e.hflip=c.hflip,e.vflip=c.vflip,e.modalityLUT=c.modalityLUT,e.voiLUT=c.voiLUT,e.voi.windowWidth<1e-6&&(e.voi.windowWidth=1e-6),e.scale<1e-4&&(e.scale=.25),f&&(a.internal.applyTransform(d),d.canvasAnnot&&a.internal.updateAnnotation(d)),g&&(b.style.background=e.invert?"#fff":"#000",a.drawImage(d,!0))}a.setViewport=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}a.updateImage=b}(cornerstone),function(a){"use strict";function b(b){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateTransform: image has not been loaded yet";c(d)}function c(a){var b=a.viewport,c="translate("+(0===b.translation.x?"-50%,":"calc("+b.translation.x+"px - 50%),")+(0===b.translation.y?"-50%)":"calc("+b.translation.y+"px - 50%))");b.rotation%360!==0&&(c+="rotate("+b.rotation+"deg)"),b.hflip&&(c+="rotateY(180deg)"),b.vflip&&(c+="rotateX(180deg)"),c+="scale("+b.scale+")",a.renderer.style.transform=c,$(a.element).trigger("CornerstoneTransformUpdated",{viewport:a.viewport,element:a.element,image:a.image,enabledElement:a,canvasContext:a.canvas.getContext("2d")})}a.updateTransform=b,a.internal.applyTransform=c}(cornerstone);